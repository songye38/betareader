<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: manuscriptModel.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: manuscriptModel.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import supabase from '@/supabase/supabaseClient';

/**
 * íŠ¹ì • ì‚¬ìš©ì ì•„ì´ë””ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì›ê³ (manuscript) ëª©ë¡ì„ ì¡°íšŒí•˜ëŠ” í•¨ìˆ˜
 *
 * - Supabaseì˜ 'manuscript' í…Œì´ë¸”ì—ì„œ user_idê°€ ì¼ì¹˜í•˜ëŠ” rowë“¤ì„ ê°€ì ¸ì˜´
 * - ìµœê·¼ ìˆ˜ì •ëœ ìˆœìœ¼ë¡œ ì •ë ¬ë¨ (`last_edited_at` ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ)
 * - limit íŒŒë¼ë¯¸í„°ê°€ ì§€ì •ë˜ë©´ ìµœëŒ€ í•´ë‹¹ ê°œìˆ˜ë§Œí¼ë§Œ ê°€ì ¸ì˜´
 *
 * @param {string} userId - ì¡°íšŒí•  ëŒ€ìƒ ì‚¬ìš©ìì˜ ID (í•„ìˆ˜)
 * @param {number|null} [limit=null] - ê°€ì ¸ì˜¬ ì›ê³  ê°œìˆ˜ ì œí•œ (ì„ íƒ)
 * @returns {Promise&lt;Array&lt;Object>>} ì›ê³  ë¦¬ìŠ¤íŠ¸ ë°°ì—´
 *
 * @throws {Error} ì¿¼ë¦¬ ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ í¬í•¨í•œ ì˜ˆì™¸ ë°œìƒ
 *
 * @example
 * const manuscripts = await fetchManuscriptsByUserId('abc123');
 * const recent = await fetchManuscriptsByUserId('abc123', 5); // ìµœì‹  5ê°œ
 */
export const fetchManuscriptsByUserId = async (userId, limit = null) => {
  let query = supabase
    .from('manuscript')
    .select('id, user_id, title, last_edited_at, episode_count')
    .eq('user_id', userId)
    .order('last_edited_at', { ascending: false });

  if (limit) {
    query = query.limit(limit);
  }

  const { data, error } = await query;

  if (error) {
    throw new Error('Manuscript fetch error: ' + error.message);
  }

  return data;
};


/**
 * íŠ¹ì • ì›ê³ (manuscript) ì•„ì´ë””ë¡œ ìƒì„¸ ì •ë³´ë¥¼ ì¡°íšŒí•˜ëŠ” í•¨ìˆ˜
 *
 * - Supabaseì˜ 'manuscript' í…Œì´ë¸”ì—ì„œ idê°€ ì¼ì¹˜í•˜ëŠ” ë‹¨ì¼ rowë¥¼ ê°€ì ¸ì˜´
 * - ë°˜í™˜ í•­ëª©: id, user_id, title, last_edited_at, episode_count
 *
 * @param {string} manuscriptId - ì¡°íšŒí•  ì›ê³ ì˜ ID (í•„ìˆ˜)
 * @returns {Promise&lt;Object>} ë‹¨ì¼ ì›ê³  ê°ì²´
 *
 * @throws {Error} ì¿¼ë¦¬ ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ í¬í•¨í•œ ì˜ˆì™¸ ë°œìƒ
 *
 * @example
 * const manuscript = await fetchManuscriptById('manuscript_001');
 * console.log(manuscript.title); // "ë‚´ ì²« ë²ˆì§¸ ì›ê³ "
 */
export const fetchManuscriptById = async (manuscriptId) => {
  const { data, error } = await supabase
    .from('manuscript')
    .select('id, user_id, title, last_edited_at, episode_count')
    .eq('id', manuscriptId) // íŠ¹ì • manuscriptIdë¡œ í•„í„°ë§
    .single(); // ë‹¨ì¼ ì›ê³ ë§Œ ë°˜í™˜

  if (error) {
    throw new Error('Manuscript fetch error: ' + error.message);
  }

  return data;
};

/**
 * ì›ê³ ë¥¼ ì¡°íšŒí•˜ëŠ” ë²”ìš© í•¨ìˆ˜
 *
 * - manuscriptIdê°€ ì£¼ì–´ì§„ ê²½ìš°: í•´ë‹¹ IDì˜ ë‹¨ì¼ ì›ê³  ì¡°íšŒ (fetchManuscriptById)
 * - manuscriptIdê°€ ì—†ì„ ê²½ìš°: í•´ë‹¹ userIdì˜ ëª¨ë“  ì›ê³  ëª©ë¡ ì¡°íšŒ (fetchManuscriptsByUserId)
 *
 * ë‚´ë¶€ì ìœ¼ë¡œ ë‘ ê°œì˜ í•¨ìˆ˜(fetchManuscriptById, fetchManuscriptsByUserId)ë¥¼ ë˜í•‘í•˜ì—¬ ìƒí™©ì— ë”°ë¼ ìë™ìœ¼ë¡œ ë¶„ê¸° ì²˜ë¦¬í•¨.
 *
 * @param {string} userId - ì¡°íšŒí•  ì‚¬ìš©ì ID (í•„ìˆ˜)
 * @param {string|null} [manuscriptId=null] - ì¡°íšŒí•  ë‹¨ì¼ ì›ê³  ID (ì„ íƒ)
 * @returns {Promise&lt;Object|Array&lt;Object>>} ë‹¨ì¼ ì›ê³  ê°ì²´ ë˜ëŠ” ì›ê³  ë¦¬ìŠ¤íŠ¸ ë°°ì—´
 *
 * @throws {Error} ë‚´ë¶€ í˜¸ì¶œ í•¨ìˆ˜ ì¤‘ í•˜ë‚˜ê°€ ì‹¤íŒ¨í•  ê²½ìš° ì˜ˆì™¸ ë°œìƒ
 *
 * @example
 * ë‹¨ì¼ ì›ê³  ì¡°íšŒ
 * const manuscript = await fetchManuscripts('abc123', 'm_001');
 *
 * ì „ì²´ ì›ê³  ì¡°íšŒ
 * const manuscripts = await fetchManuscripts('abc123');
 */

export const fetchManuscripts = async (userId, manuscriptId = null) => {
  if (manuscriptId) {
    // manuscriptIdê°€ ìˆì„ ê²½ìš° í•´ë‹¹ ì›ê³ ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
    return await fetchManuscriptById(manuscriptId);
  }

  // manuscriptIdê°€ ì—†ì„ ê²½ìš° userIdë¡œ ì›ê³ ë“¤ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
  return await fetchManuscriptsByUserId(userId);
};


/**
 * ì›ê³ (manuscript)ì˜ ì—í”¼ì†Œë“œ ê°œìˆ˜ë¥¼ ì¦ê°ì‹œí‚¤ëŠ” í•¨ìˆ˜
 *
 * - í˜„ì¬ episode_count ê°’ì„ ë¶ˆëŸ¬ì˜¨ í›„, delta ë§Œí¼ ë”í•˜ê±°ë‚˜ ë¹¼ì„œ ë‹¤ì‹œ ì €ì¥
 * - ê²°ê³¼ì ìœ¼ë¡œ episode_countëŠ” ìµœì†Œ 0 ì´ìƒìœ¼ë¡œ ìœ ì§€ë¨
 * - ì¦ê°€(delta > 0)ë‚˜ ê°ì†Œ(delta &lt; 0) ëª¨ë‘ ì²˜ë¦¬ ê°€ëŠ¥
 *
 * @param {string} manuscriptId - ì—í”¼ì†Œë“œ ìˆ˜ë¥¼ ì—…ë°ì´íŠ¸í•  ì›ê³  ID (í•„ìˆ˜)
 * @param {number} [delta=1] - ë³€ê²½í•  ì—í”¼ì†Œë“œ ìˆ˜ (ê¸°ë³¸ê°’: +1, ìŒìˆ˜ ê°€ëŠ¥)
 * @returns {Promise&lt;Object|null>} ì—…ë°ì´íŠ¸ëœ ì›ê³  ê°ì²´ ë˜ëŠ” ì‹¤íŒ¨ ì‹œ null
 *
 * @throws {Error} ë°ì´í„° ì¡°íšŒ ë˜ëŠ” ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí•  ìˆ˜ ìˆìŒ (ë‚´ë¶€ try-catchë¡œ ë¡œê·¸ ì²˜ë¦¬ë¨)
 *
 * @example
 * await updateEpisodeCount('m_001');        // ì—í”¼ì†Œë“œ ìˆ˜ +1
 * await updateEpisodeCount('m_001', -1);    // ì—í”¼ì†Œë“œ ìˆ˜ -1 (ë‹¨, 0 ë¯¸ë§Œìœ¼ë¡œëŠ” ë‚´ë ¤ê°€ì§€ ì•ŠìŒ)
 */

export const updateEpisodeCount = async (manuscriptId, delta = 1) => {
  try {
    // í˜„ì¬ episode_count ê°€ì ¸ì˜¤ê¸°
    const { data: currentData, error: fetchError } = await supabase
      .from('manuscript')
      .select('episode_count')
      .eq('id', manuscriptId)
      .single();

    if (fetchError) {
      console.error('ğŸ“› Fetch error:', fetchError);
      throw new Error('ì—í”¼ì†Œë“œ ìˆ˜ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }

    const newCount = Math.max((currentData.episode_count || 0) + delta, 0); // 0 ì´í•˜ë¡œ ë‚´ë ¤ê°€ì§€ ì•Šê²Œ

    // episode_count ì—…ë°ì´íŠ¸
    const { data, error: updateError } = await supabase
      .from('manuscript')
      .update({
        episode_count: newCount,
      })
      .eq('id', manuscriptId)
      .select()
      .single();

    if (updateError) {
      console.error('ğŸ“› Update error:', updateError);
      throw new Error('ì—í”¼ì†Œë“œ ìˆ˜ ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }

    return data;

  } catch (error) {
    console.error('âŒ updateEpisodeCount ì‹¤íŒ¨:', error.message);
    return null;
  }
};


/**
 * ì›ê³ (manuscript)ì˜ ë§ˆì§€ë§‰ ìˆ˜ì • ì‹œê°(`last_edited_at`)ì„ í˜„ì¬ ì‹œê°ìœ¼ë¡œ ì—…ë°ì´íŠ¸í•˜ëŠ” í•¨ìˆ˜
 *
 * - í˜„ì¬ ì‹œê°ì„ ISO 8601 ë¬¸ìì—´ë¡œ ìƒì„± í›„ DBì— ì €ì¥
 * - ì¼ë°˜ì ìœ¼ë¡œ ì›ê³  ìˆ˜ì • ì‹œ í˜¸ì¶œë˜ì–´ ë³€ê²½ ì‚¬í•­ì´ ìˆìŒì„ ê¸°ë¡í•¨
 *
 * @param {string} manuscriptId - ë§ˆì§€ë§‰ ìˆ˜ì • ì‹œê°„ì„ ê°±ì‹ í•  ì›ê³  ID (í•„ìˆ˜)
 * @returns {Promise&lt;Object|null>} ì—…ë°ì´íŠ¸ëœ ì›ê³  ê°ì²´ ë˜ëŠ” ì‹¤íŒ¨ ì‹œ null
 *
 * @throws {Error} DB ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ ê°€ëŠ¥ (ë‚´ë¶€ try-catchë¡œ ì²˜ë¦¬ë˜ì–´ ë¡œê·¸ ì¶œë ¥ ë° null ë°˜í™˜)
 *
 * @example
 * await updateLastEditedAt('m_001');
 */

export const updateLastEditedAt = async (manuscriptId) => {
  try {
    const now = new Date().toISOString(); // í˜„ì¬ ì‹œê°„ ISO í˜•ì‹ìœ¼ë¡œ

    // last_edited_at ì—…ë°ì´íŠ¸
    const { data, error: updateError } = await supabase
      .from('manuscript')
      .update({
        last_edited_at: now,
      })
      .eq('id', manuscriptId)
      .select()
      .single();

    if (updateError) {
      console.error('ğŸ“› Update error:', updateError);
      throw new Error('ë§ˆì§€ë§‰ ìˆ˜ì • ì‹œê°„ ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }

    return data;

  } catch (error) {
    console.error('âŒ updateLastEditedAt ì‹¤íŒ¨:', error.message);
    return null;
  }
};

/**
 * ì›ê³ (manuscript)ì˜ ì œëª©(title)ì„ ìˆ˜ì •í•˜ëŠ” í•¨ìˆ˜
 *
 * - ì§€ì •í•œ manuscriptIdì— í•´ë‹¹í•˜ëŠ” ì›ê³ ì˜ title í•„ë“œë¥¼ ìƒˆ ê°’ìœ¼ë¡œ ê°±ì‹ 
 * - ì£¼ë¡œ ì‚¬ìš©ì í¸ì§‘ í™”ë©´ì—ì„œ ì œëª© ë³€ê²½ ì‹œ ì‚¬ìš©
 *
 * @param {string} manuscriptId - ì œëª©ì„ ìˆ˜ì •í•  ì›ê³ ì˜ ID (í•„ìˆ˜)
 * @param {string} newTitle - ìƒˆë¡œ ì„¤ì •í•  ì œëª© ë¬¸ìì—´ (í•„ìˆ˜)
 * @returns {Promise&lt;Object|null>} ì—…ë°ì´íŠ¸ëœ ì›ê³  ê°ì²´ ë˜ëŠ” ì‹¤íŒ¨ ì‹œ null
 *
 * @throws {Error} DB ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ ê°€ëŠ¥ (ë‚´ë¶€ try-catchë¡œ ì²˜ë¦¬ë¨)
 *
 * @example
 * await updateManuscriptTitle('m_001', 'ìƒˆë¡œìš´ ì´ì•¼ê¸° ì œëª©');
 */

export const updateManuscriptTitle = async (manuscriptId, newTitle) => {
  try {
    const { data, error } = await supabase
      .from('manuscript')
      .update({
        title: newTitle,
      })
      .eq('id', manuscriptId)
      .select()
      .single();

    if (error) {
      console.error('ğŸ“› Update error:', error);
      throw new Error('ì œëª© ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }

    return data;
  } catch (error) {
    console.error('âŒ updateManuscriptTitle ì‹¤íŒ¨:', error.message);
    return null;
  }
};


/**
 * ì›ê³ (manuscript)ë¥¼ ID ê¸°ì¤€ìœ¼ë¡œ ì‚­ì œí•˜ëŠ” í•¨ìˆ˜
 *
 * - Supabaseì˜ 'manuscript' í…Œì´ë¸”ì—ì„œ ì§€ì •í•œ manuscriptIdì— í•´ë‹¹í•˜ëŠ” rowë¥¼ ì‚­ì œ
 * - ì‚­ì œ í›„ ì‚­ì œëœ ë°ì´í„°ë¥¼ ë°˜í™˜ (ì˜ˆ: title, id ë“±)
 *
 * @param {string} manuscriptId - ì‚­ì œí•  ì›ê³ ì˜ ID (í•„ìˆ˜)
 * @returns {Promise&lt;Object|null>} ì‚­ì œëœ ì›ê³  ë°ì´í„° ë˜ëŠ” ì‹¤íŒ¨ ì‹œ null
 *
 * @throws {Error} ì‚­ì œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ ì‹œ ì˜ˆì™¸ (ë‚´ë¶€ try-catchë¡œ ë¡œê·¸ ì¶œë ¥ ë° null ë°˜í™˜)
 *
 * @example
 * await deleteManuscriptById('m_001');
 */

export const deleteManuscriptById = async (manuscriptId) => {
  try {
    const { data, error } = await supabase
      .from('manuscript')
      .delete()
      .eq('id', manuscriptId) // idì— ë§ëŠ” ì›ê³ ì§‘ì„ ì‚­ì œ
      .single(); // ì‚­ì œëœ ì›ê³  ë°ì´í„°ë¥¼ ë°˜í™˜

    if (error) {
      console.error('ğŸ“› Delete error:', error);
      throw new Error('ì›ê³ ì§‘ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }

    return data; // ì‚­ì œëœ ì›ê³  ë°ì´í„°ë¥¼ ë°˜í™˜
  } catch (error) {
    console.error('âŒ deleteManuscriptById ì‹¤íŒ¨:', error.message);
    return null;
  }
};



</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#checkAndUpdateExpiredStatus">checkAndUpdateExpiredStatus</a></li><li><a href="global.html#createCommentLink">createCommentLink</a></li><li><a href="global.html#deleteManuscriptById">deleteManuscriptById</a></li><li><a href="global.html#fetchComments">fetchComments</a></li><li><a href="global.html#fetchLinkInfo">fetchLinkInfo</a></li><li><a href="global.html#fetchManuscriptById">fetchManuscriptById</a></li><li><a href="global.html#fetchManuscripts">fetchManuscripts</a></li><li><a href="global.html#fetchManuscriptsByUserId">fetchManuscriptsByUserId</a></li><li><a href="global.html#getProfileGoals">getProfileGoals</a></li><li><a href="global.html#updateEpisodeCount">updateEpisodeCount</a></li><li><a href="global.html#updateLastEditedAt">updateLastEditedAt</a></li><li><a href="global.html#updateManuscriptTitle">updateManuscriptTitle</a></li><li><a href="global.html#updateProfileGoals">updateProfileGoals</a></li><li><a href="global.html#uploadProfileImage">uploadProfileImage</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Wed Apr 23 2025 09:35:18 GMT+0900 (Korean Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
